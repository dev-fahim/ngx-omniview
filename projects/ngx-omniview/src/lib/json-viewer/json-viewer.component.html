<ul class="jv">
  <ng-container *ngFor="let key of renderKeys; let last = last; let i = index">
    <!-- Opening line -->
    <li class="jv-line">
      <button *ngIf="isObject(getValueByKey(key))"
              class="jv-toggle"
              [class.collapsed]="collapsed[key]"
              (click)="toggle(key)"
              aria-label="Toggle">
        {{ collapsed[key] ? '▶' : '▼' }}
      </button>
      <span *ngIf="!isObject(getValueByKey(key))" class="jv-spacer"></span>

      <ng-container *ngIf="key !== '__root__'">
        <span [class]="isArray ? 'jv-index' : 'jv-key'">{{ isArray ? i : key }}</span>
        <span class="jv-colon">:</span>
      </ng-container>

      <!-- Object/array collapsed preview -->
      <ng-container *ngIf="isObject(getValueByKey(key)) && collapsed[key]">
        <span class="jv-bracket">{{ getBracket(getValueByKey(key), true) }}</span>
        <span class="jv-ellipsis">...</span>
        <span class="jv-bracket">{{ getBracket(getValueByKey(key), false) }}</span>
        <span *ngIf="showCounts" class="jv-count">{{ getCountLabel(getValueByKey(key)) }}</span>
        <span *ngIf="!last" class="jv-comma">,</span>
      </ng-container>

      <!-- Primitive value -->
      <ng-container *ngIf="!isObject(getValueByKey(key))">
        <span [ngClass]="getValueClass(getValueByKey(key))">{{ formatValue(getValueByKey(key)) }}</span>
        <span *ngIf="!last" class="jv-comma">,</span>
      </ng-container>

      <!-- Opening bracket when expanded -->
      <ng-container *ngIf="isObject(getValueByKey(key)) && !collapsed[key]">
        <span class="jv-bracket">{{ getBracket(getValueByKey(key), true) }}</span>
      </ng-container>
    </li>

    <!-- Nested content when expanded -->
    <li *ngIf="isObject(getValueByKey(key)) && !collapsed[key]" class="jv-children">
      <json-viewer [data]="getValueByKey(key)" [level]="level + 1" [showCounts]="showCounts"></json-viewer>
    </li>

    <!-- Closing line when expanded -->
    <li *ngIf="isObject(getValueByKey(key)) && !collapsed[key]" class="jv-line">
      <span class="jv-spacer"></span>
      <span class="jv-bracket">{{ getBracket(getValueByKey(key), false) }}</span>
      <span *ngIf="!last" class="jv-comma">,</span>
    </li>
  </ng-container>
</ul>
